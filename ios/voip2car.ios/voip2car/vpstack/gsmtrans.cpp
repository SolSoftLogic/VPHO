void gsm_fromms(unsigned char *in, unsigned char *out)
{
	unsigned short LARc[8], Nc[4], Mc[4], bc[4], xmaxc[4], xmc[13*4];

	unsigned char *c = in;
	
	LARc[0]  = *c & 0x3F;
	LARc[1]  = (*c++ >> 6) & 0x3;
	LARc[1] |= (*c & 0xF) << 2;
	LARc[2]  = (*c++ >> 4) & 0xF;
	LARc[2] |= (*c & 0x1) << 4;
	LARc[3]  = (*c >> 1) & 0x1F;
	LARc[4]  = (*c++ >> 6) & 0x3;
	LARc[4] |= (*c & 0x3) << 2;
	LARc[5]  = (*c >> 2) & 0xF;
	LARc[6]  = (*c++ >> 6) & 0x3;
	LARc[6] |= (*c & 0x1) << 2;
	LARc[7]  = (*c >> 1) & 0x7;
	Nc[0]  = (*c++ >> 4) & 0xF;
	Nc[0] |= (*c & 0x7) << 4;
	bc[0]  = (*c >> 3) & 0x3;
	Mc[0]  = (*c >> 5) & 0x3;
	xmaxc[0]  = (*c++ >> 7) & 0x1;
	xmaxc[0] |= (*c & 0x1F) << 1;
	xmc[0]  = (*c++ >> 5) & 0x7;
	xmc[1]  = *c & 0x7;
	xmc[2]  = (*c >> 3) & 0x7;
	xmc[3]  = (*c++ >> 6) & 0x3;
	xmc[3] |= (*c & 0x1) << 2;
	xmc[4]  = (*c >> 1) & 0x7;
	xmc[5]  = (*c >> 4) & 0x7;
	xmc[6]  = (*c++ >> 7) & 0x1;
	xmc[6] |= (*c & 0x3) << 1;
	xmc[7]  = (*c >> 2) & 0x7;
	xmc[8]  = (*c++ >> 5) & 0x7;
	xmc[9]  = *c & 0x7;
	xmc[10]  = (*c >> 3) & 0x7;
	xmc[11]  = (*c++ >> 6) & 0x3;
	xmc[11] |= (*c & 0x1) << 2;
	xmc[12]  = (*c >> 1) & 0x7;
	Nc[1]  = (*c++ >> 4) & 0xF;
	Nc[1] |= (*c & 0x7) << 4;
	bc[1]  = (*c >> 3) & 0x3;
	Mc[1]  = (*c >> 5) & 0x3;
	xmaxc[1]  = (*c++ >> 7) & 0x1;
	xmaxc[1] |= (*c & 0x1F) << 1;
	xmc[13]  = (*c++ >> 5) & 0x7;
	xmc[14]  = *c & 0x7;
	xmc[15]  = (*c >> 3) & 0x7;
	xmc[16]  = (*c++ >> 6) & 0x3;
	xmc[16] |= (*c & 0x1) << 2;
	xmc[17]  = (*c >> 1) & 0x7;
	xmc[18]  = (*c >> 4) & 0x7;
	xmc[19]  = (*c++ >> 7) & 0x1;
	xmc[19] |= (*c & 0x3) << 1;
	xmc[20]  = (*c >> 2) & 0x7;
	xmc[21]  = (*c++ >> 5) & 0x7;
	xmc[22]  = *c & 0x7;
	xmc[23]  = (*c >> 3) & 0x7;
	xmc[24]  = (*c++ >> 6) & 0x3;
	xmc[24] |= (*c & 0x1) << 2;
	xmc[25]  = (*c >> 1) & 0x7;
	Nc[2]  = (*c++ >> 4) & 0xF;
	Nc[2] |= (*c & 0x7) << 4;
	bc[2]  = (*c >> 3) & 0x3;
	Mc[2]  = (*c >> 5) & 0x3;
	xmaxc[2]  = (*c++ >> 7) & 0x1;
	xmaxc[2] |= (*c & 0x1F) << 1;
	xmc[26]  = (*c++ >> 5) & 0x7;
	xmc[27]  = *c & 0x7;
	xmc[28]  = (*c >> 3) & 0x7;
	xmc[29]  = (*c++ >> 6) & 0x3;
	xmc[29] |= (*c & 0x1) << 2;
	xmc[30]  = (*c >> 1) & 0x7;
	xmc[31]  = (*c >> 4) & 0x7;
	xmc[32]  = (*c++ >> 7) & 0x1;
	xmc[32] |= (*c & 0x3) << 1;
	xmc[33]  = (*c >> 2) & 0x7;
	xmc[34]  = (*c++ >> 5) & 0x7;
	xmc[35]  = *c & 0x7;
	xmc[36]  = (*c >> 3) & 0x7;
	xmc[37]  = (*c++ >> 6) & 0x3;
	xmc[37] |= (*c & 0x1) << 2;
	xmc[38]  = (*c >> 1) & 0x7;
	Nc[3]  = (*c++ >> 4) & 0xF;
	Nc[3] |= (*c & 0x7) << 4;
	bc[3]  = (*c >> 3) & 0x3;
	Mc[3]  = (*c >> 5) & 0x3;
	xmaxc[3]  = (*c++ >> 7) & 0x1;
	xmaxc[3] |= (*c & 0x1F) << 1;
	xmc[39]  = (*c++ >> 5) & 0x7;
	xmc[40]  = *c & 0x7;
	xmc[41]  = (*c >> 3) & 0x7;
	xmc[42]  = (*c++ >> 6) & 0x3;
	xmc[42] |= (*c & 0x1) << 2;
	xmc[43]  = (*c >> 1) & 0x7;
	xmc[44]  = (*c >> 4) & 0x7;
	xmc[45]  = (*c++ >> 7) & 0x1;
	xmc[45] |= (*c & 0x3) << 1;
	xmc[46]  = (*c >> 2) & 0x7;
	xmc[47]  = (*c++ >> 5) & 0x7;
	xmc[48]  = *c & 0x7;
	xmc[49]  = (*c >> 3) & 0x7;
	xmc[50]  = (*c++ >> 6) & 0x3;
	xmc[50] |= (*c & 0x1) << 2;
	xmc[51]  = (*c >> 1) & 0x7;

	c = out;
	*c++ =   ((0xd & 0xF) << 4)		/* 1 */
	       | ((LARc[0] >> 2) & 0xF);
	*c++ =   ((LARc[0] & 0x3) << 6)
	       | (LARc[1] & 0x3F);
	*c++ =   ((LARc[2] & 0x1F) << 3)
	       | ((LARc[3] >> 2) & 0x7);
	*c++ =   ((LARc[3] & 0x3) << 6)
	       | ((LARc[4] & 0xF) << 2)
	       | ((LARc[5] >> 2) & 0x3);
	*c++ =   ((LARc[5] & 0x3) << 6)
	       | ((LARc[6] & 0x7) << 3)
	       | (LARc[7] & 0x7);
	*c++ =   ((Nc[0] & 0x7F) << 1)
	       | ((bc[0] >> 1) & 0x1);
	*c++ =   ((bc[0] & 0x1) << 7)
	       | ((Mc[0] & 0x3) << 5)
	       | ((xmaxc[0] >> 1) & 0x1F);
	*c++ =   ((xmaxc[0] & 0x1) << 7)
	       | ((xmc[0] & 0x7) << 4)
	       | ((xmc[1] & 0x7) << 1)
	       | ((xmc[2] >> 2) & 0x1);
	*c++ =   ((xmc[2] & 0x3) << 6)
	       | ((xmc[3] & 0x7) << 3)
	       | (xmc[4] & 0x7);
	*c++ =   ((xmc[5] & 0x7) << 5)			/* 10 */
	       | ((xmc[6] & 0x7) << 2)
	       | ((xmc[7] >> 1) & 0x3);
	*c++ =   ((xmc[7] & 0x1) << 7)
	       | ((xmc[8] & 0x7) << 4)
	       | ((xmc[9] & 0x7) << 1)
	       | ((xmc[10] >> 2) & 0x1);
	*c++ =   ((xmc[10] & 0x3) << 6)
	       | ((xmc[11] & 0x7) << 3)
	       | (xmc[12] & 0x7);
	*c++ =   ((Nc[1] & 0x7F) << 1)
	       | ((bc[1] >> 1) & 0x1);
	*c++ =   ((bc[1] & 0x1) << 7)
	       | ((Mc[1] & 0x3) << 5)
	       | ((xmaxc[1] >> 1) & 0x1F);
	*c++ =   ((xmaxc[1] & 0x1) << 7)
	       | ((xmc[13] & 0x7) << 4)
	       | ((xmc[14] & 0x7) << 1)
	       | ((xmc[15] >> 2) & 0x1);
	*c++ =   ((xmc[15] & 0x3) << 6)
	       | ((xmc[16] & 0x7) << 3)
	       | (xmc[17] & 0x7);
	*c++ =   ((xmc[18] & 0x7) << 5)
	       | ((xmc[19] & 0x7) << 2)
	       | ((xmc[20] >> 1) & 0x3);
	*c++ =   ((xmc[20] & 0x1) << 7)
	       | ((xmc[21] & 0x7) << 4)
	       | ((xmc[22] & 0x7) << 1)
	       | ((xmc[23] >> 2) & 0x1);
	*c++ =   ((xmc[23] & 0x3) << 6)
	       | ((xmc[24] & 0x7) << 3)
	       | (xmc[25] & 0x7);
	*c++ =   ((Nc[2] & 0x7F) << 1)			/* 20 */
	       | ((bc[2] >> 1) & 0x1);
	*c++ =   ((bc[2] & 0x1) << 7)
	       | ((Mc[2] & 0x3) << 5)
	       | ((xmaxc[2] >> 1) & 0x1F);
	*c++ =   ((xmaxc[2] & 0x1) << 7)
	       | ((xmc[26] & 0x7) << 4)
	       | ((xmc[27] & 0x7) << 1)
	       | ((xmc[28] >> 2) & 0x1);
	*c++ =   ((xmc[28] & 0x3) << 6)
	       | ((xmc[29] & 0x7) << 3)
	       | (xmc[30] & 0x7);
	*c++ =   ((xmc[31] & 0x7) << 5)
	       | ((xmc[32] & 0x7) << 2)
	       | ((xmc[33] >> 1) & 0x3);
	*c++ =   ((xmc[33] & 0x1) << 7)
	       | ((xmc[34] & 0x7) << 4)
	       | ((xmc[35] & 0x7) << 1)
	       | ((xmc[36] >> 2) & 0x1);
	*c++ =   ((xmc[36] & 0x3) << 6)
	       | ((xmc[37] & 0x7) << 3)
	       | (xmc[38] & 0x7);
	*c++ =   ((Nc[3] & 0x7F) << 1)
	       | ((bc[3] >> 1) & 0x1);
	*c++ =   ((bc[3] & 0x1) << 7)
	       | ((Mc[3] & 0x3) << 5)
	       | ((xmaxc[3] >> 1) & 0x1F);
	*c++ =   ((xmaxc[3] & 0x1) << 7)
	       | ((xmc[39] & 0x7) << 4)
	       | ((xmc[40] & 0x7) << 1)
	       | ((xmc[41] >> 2) & 0x1);
	*c++ =   ((xmc[41] & 0x3) << 6)			/* 30 */
	       | ((xmc[42] & 0x7) << 3)
	       | (xmc[43] & 0x7);
	*c++ =   ((xmc[44] & 0x7) << 5)
	       | ((xmc[45] & 0x7) << 2)
	       | ((xmc[46] >> 1) & 0x3);
	*c++ =   ((xmc[46] & 0x1) << 7)
	       | ((xmc[47] & 0x7) << 4)
	       | ((xmc[48] & 0x7) << 1)
	       | ((xmc[49] >> 2) & 0x1);
	*c++ =   ((xmc[49] & 0x3) << 6)
	       | ((xmc[50] & 0x7) << 3)
	       | (xmc[51] & 0x7);
}

void gsm_toms(unsigned char *in, unsigned char *out)
{
	unsigned short LARc[8], Nc[4], Mc[4], bc[4], xmaxc[4], xmc[13*4];

	unsigned char *c = in;

	LARc[0]  = (*c++ & 0xF) << 2;		/* 1 */
	LARc[0] |= (*c >> 6) & 0x3;
	LARc[1]  = *c++ & 0x3F;
	LARc[2]  = (*c >> 3) & 0x1F;
	LARc[3]  = (*c++ & 0x7) << 2;
	LARc[3] |= (*c >> 6) & 0x3;
	LARc[4]  = (*c >> 2) & 0xF;
	LARc[5]  = (*c++ & 0x3) << 2;
	LARc[5] |= (*c >> 6) & 0x3;
	LARc[6]  = (*c >> 3) & 0x7;
	LARc[7]  = *c++ & 0x7;
	Nc[0]  = (*c >> 1) & 0x7F;
	bc[0]  = (*c++ & 0x1) << 1;
	bc[0] |= (*c >> 7) & 0x1;
	Mc[0]  = (*c >> 5) & 0x3;
	xmaxc[0]  = (*c++ & 0x1F) << 1;
	xmaxc[0] |= (*c >> 7) & 0x1;
	xmc[0]  = (*c >> 4) & 0x7;
	xmc[1]  = (*c >> 1) & 0x7;
	xmc[2]  = (*c++ & 0x1) << 2;
	xmc[2] |= (*c >> 6) & 0x3;
	xmc[3]  = (*c >> 3) & 0x7;
	xmc[4]  = *c++ & 0x7;
	xmc[5]  = (*c >> 5) & 0x7;
	xmc[6]  = (*c >> 2) & 0x7;
	xmc[7]  = (*c++ & 0x3) << 1;		/* 10 */
	xmc[7] |= (*c >> 7) & 0x1;
	xmc[8]  = (*c >> 4) & 0x7;
	xmc[9]  = (*c >> 1) & 0x7;
	xmc[10]  = (*c++ & 0x1) << 2;
	xmc[10] |= (*c >> 6) & 0x3;
	xmc[11]  = (*c >> 3) & 0x7;
	xmc[12]  = *c++ & 0x7;
	Nc[1]  = (*c >> 1) & 0x7F;
	bc[1]  = (*c++ & 0x1) << 1;
	bc[1] |= (*c >> 7) & 0x1;
	Mc[1]  = (*c >> 5) & 0x3;
	xmaxc[1]  = (*c++ & 0x1F) << 1;
	xmaxc[1] |= (*c >> 7) & 0x1;
	xmc[13]  = (*c >> 4) & 0x7;
	xmc[14]  = (*c >> 1) & 0x7;
	xmc[15]  = (*c++ & 0x1) << 2;
	xmc[15] |= (*c >> 6) & 0x3;
	xmc[16]  = (*c >> 3) & 0x7;
	xmc[17]  = *c++ & 0x7;
	xmc[18]  = (*c >> 5) & 0x7;
	xmc[19]  = (*c >> 2) & 0x7;
	xmc[20]  = (*c++ & 0x3) << 1;
	xmc[20] |= (*c >> 7) & 0x1;
	xmc[21]  = (*c >> 4) & 0x7;
	xmc[22]  = (*c >> 1) & 0x7;
	xmc[23]  = (*c++ & 0x1) << 2;
	xmc[23] |= (*c >> 6) & 0x3;
	xmc[24]  = (*c >> 3) & 0x7;
	xmc[25]  = *c++ & 0x7;
	Nc[2]  = (*c >> 1) & 0x7F;
	bc[2]  = (*c++ & 0x1) << 1;		/* 20 */
	bc[2] |= (*c >> 7) & 0x1;
	Mc[2]  = (*c >> 5) & 0x3;
	xmaxc[2]  = (*c++ & 0x1F) << 1;
	xmaxc[2] |= (*c >> 7) & 0x1;
	xmc[26]  = (*c >> 4) & 0x7;
	xmc[27]  = (*c >> 1) & 0x7;
	xmc[28]  = (*c++ & 0x1) << 2;
	xmc[28] |= (*c >> 6) & 0x3;
	xmc[29]  = (*c >> 3) & 0x7;
	xmc[30]  = *c++ & 0x7;
	xmc[31]  = (*c >> 5) & 0x7;
	xmc[32]  = (*c >> 2) & 0x7;
	xmc[33]  = (*c++ & 0x3) << 1;
	xmc[33] |= (*c >> 7) & 0x1;
	xmc[34]  = (*c >> 4) & 0x7;
	xmc[35]  = (*c >> 1) & 0x7;
	xmc[36]  = (*c++ & 0x1) << 2;
	xmc[36] |= (*c >> 6) & 0x3;
	xmc[37]  = (*c >> 3) & 0x7;
	xmc[38]  = *c++ & 0x7;
	Nc[3]  = (*c >> 1) & 0x7F;
	bc[3]  = (*c++ & 0x1) << 1;
	bc[3] |= (*c >> 7) & 0x1;
	Mc[3]  = (*c >> 5) & 0x3;
	xmaxc[3]  = (*c++ & 0x1F) << 1;
	xmaxc[3] |= (*c >> 7) & 0x1;
	xmc[39]  = (*c >> 4) & 0x7;
	xmc[40]  = (*c >> 1) & 0x7;
	xmc[41]  = (*c++ & 0x1) << 2;
	xmc[41] |= (*c >> 6) & 0x3;
	xmc[42]  = (*c >> 3) & 0x7;
	xmc[43]  = *c++ & 0x7;			/* 30  */
	xmc[44]  = (*c >> 5) & 0x7;
	xmc[45]  = (*c >> 2) & 0x7;
	xmc[46]  = (*c++ & 0x3) << 1;
	xmc[46] |= (*c >> 7) & 0x1;
	xmc[47]  = (*c >> 4) & 0x7;
	xmc[48]  = (*c >> 1) & 0x7;
	xmc[49]  = (*c++ & 0x1) << 2;
	xmc[49] |= (*c >> 6) & 0x3;
	xmc[50]  = (*c >> 3) & 0x7;
	xmc[51]  = *c & 0x7;			/* 33 */

	c = out;




	*c++ =   (LARc[0] & 0x3F)	       | ((LARc[1] & 0x3) << 6);
	*c++ =   ((LARc[1] >> 2) & 0xF)	       | ((LARc[2] & 0xF) << 4);
	*c++ =   ((LARc[2] >> 4) & 0x1)	       | ((LARc[3] & 0x1F) << 1)
	       | ((LARc[4] & 0x3) << 6);
	*c++ =   ((LARc[4] >> 2) & 0x3)	       | ((LARc[5] & 0xF) << 2)
	       | ((LARc[6] & 0x3) << 6);
	*c++ =   ((LARc[6] >> 2) & 0x1)	       | ((LARc[7] & 0x7) << 1)
	       | ((Nc[0] & 0xF) << 4);
	*c++ =   ((Nc[0] >> 4) & 0x7)	       | ((bc[0] & 0x3) << 3)
	       | ((Mc[0] & 0x3) << 5)
	       | ((xmaxc[0] & 0x1) << 7);
	*c++ =   ((xmaxc[0] >> 1) & 0x1F)	       | ((xmc[0] & 0x7) << 5);
	*c++ =   (xmc[1] & 0x7)	       | ((xmc[2] & 0x7) << 3)
	       | ((xmc[3] & 0x3) << 6);
	*c++ =   ((xmc[3] >> 2) & 0x1)	       | ((xmc[4] & 0x7) << 1)
	       | ((xmc[5] & 0x7) << 4)
	       | ((xmc[6] & 0x1) << 7);
	*c++ =   ((xmc[6] >> 1) & 0x3)	       | ((xmc[7] & 0x7) << 2)
	       | ((xmc[8] & 0x7) << 5);
	*c++ =   (xmc[9] & 0x7)	       | ((xmc[10] & 0x7) << 3)
	       | ((xmc[11] & 0x3) << 6);
	*c++ =   ((xmc[11] >> 2) & 0x1)	       | ((xmc[12] & 0x7) << 1)
	       | ((Nc[1] & 0xF) << 4);
	*c++ =   ((Nc[1] >> 4) & 0x7)	       | ((bc[1] & 0x3) << 3)
	       | ((Mc[1] & 0x3) << 5)
	       | ((xmaxc[1] & 0x1) << 7);
	*c++ =   ((xmaxc[1] >> 1) & 0x1F)	       | ((xmc[13] & 0x7) << 5);
	*c++ =   (xmc[14] & 0x7)	       | ((xmc[15] & 0x7) << 3)
	       | ((xmc[16] & 0x3) << 6);
	*c++ =   ((xmc[16] >> 2) & 0x1)	       | ((xmc[17] & 0x7) << 1)
	       | ((xmc[18] & 0x7) << 4)
	       | ((xmc[19] & 0x1) << 7);
	*c++ =   ((xmc[19] >> 1) & 0x3)	       | ((xmc[20] & 0x7) << 2)
	       | ((xmc[21] & 0x7) << 5);
	*c++ =   (xmc[22] & 0x7)	       | ((xmc[23] & 0x7) << 3)
	       | ((xmc[24] & 0x3) << 6);
	*c++ =   ((xmc[24] >> 2) & 0x1)	       | ((xmc[25] & 0x7) << 1)
	       | ((Nc[2] & 0xF) << 4);
	*c++ =   ((Nc[2] >> 4) & 0x7)	       | ((bc[2] & 0x3) << 3)
	       | ((Mc[2] & 0x3) << 5)
	       | ((xmaxc[2] & 0x1) << 7);
	*c++ =   ((xmaxc[2] >> 1) & 0x1F)	       | ((xmc[26] & 0x7) << 5);
	*c++ =   (xmc[27] & 0x7)	       | ((xmc[28] & 0x7) << 3)
	       | ((xmc[29] & 0x3) << 6);
	*c++ =   ((xmc[29] >> 2) & 0x1)	       | ((xmc[30] & 0x7) << 1)
	       | ((xmc[31] & 0x7) << 4)
	       | ((xmc[32] & 0x1) << 7);
	*c++ =   ((xmc[32] >> 1) & 0x3)	       | ((xmc[33] & 0x7) << 2)
	       | ((xmc[34] & 0x7) << 5);
	*c++ =   (xmc[35] & 0x7)	       | ((xmc[36] & 0x7) << 3)
	       | ((xmc[37] & 0x3) << 6);
	*c++ =   ((xmc[37] >> 2) & 0x1)	       | ((xmc[38] & 0x7) << 1)
	       | ((Nc[3] & 0xF) << 4);
	*c++ =   ((Nc[3] >> 4) & 0x7)	       | ((bc[3] & 0x3) << 3)
	       | ((Mc[3] & 0x3) << 5)
	       | ((xmaxc[3] & 0x1) << 7);
	*c++ =   ((xmaxc[3] >> 1) & 0x1F)	       | ((xmc[39] & 0x7) << 5);
	*c++ =   (xmc[40] & 0x7)	       | ((xmc[41] & 0x7) << 3)
	       | ((xmc[42] & 0x3) << 6);
	*c++ =   ((xmc[42] >> 2) & 0x1)	       | ((xmc[43] & 0x7) << 1)
	       | ((xmc[44] & 0x7) << 4)
	       | ((xmc[45] & 0x1) << 7);
	*c++ =   ((xmc[45] >> 1) & 0x3)	       | ((xmc[46] & 0x7) << 2)
	       | ((xmc[47] & 0x7) << 5);
	*c++ =   (xmc[48] & 0x7)	       | ((xmc[49] & 0x7) << 3)
	       | ((xmc[50] & 0x3) << 6);
	*c++ =   ((xmc[50] >> 2) & 0x1)	       | ((xmc[51] & 0x7) << 1);
}

